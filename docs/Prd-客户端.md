# 产品需求文档 (PRD) - 客户端（用户刷题界面）

## 文档信息
- **版本**: v1.0.0
- **创建日期**: 2026-02-05
- **产品定位**: 题库刷题平台 - 用户端
- **目标用户**: 考试备考学员（驾考/突击考试/各类资格考试）

---

## 一、产品定位与愿景

### 1.1 核心使命
为备考学员提供**高质量、整理好的题库资源**，让用户无需自己整理题库，直接进入刷题模式，快速记忆答案和理解解析，提升备考效率。

### 1.2 产品定位
**内容型产品**：平台主导提供题库内容，用户直接刷题
- ❌ 不是工具型产品（用户上传→AI解析→刷题）
- ✅ 而是内容型产品（平台提供题库→用户直接刷题）

### 1.3 核心价值主张
1. **零门槛刷题**：无需整理题库，直接进入刷题模式
2. **大屏体验**：优先电脑端，左右分栏布局，题目答案一目了然
3. **即时反馈**：点击题目即可看到正确答案和详细解析
4. **AI陪伴**：解析不满意时，可追问AI获取更深入的解释
5. **进度追踪**：自动记录刷题进度和错题，方便复习

---

## 二、用户画像 (Persona)

### 2.1 目标用户
- **自主备考学员**：需要快速刷题掌握考点，没有时间自己整理题库
- **驾考/突击学员**：备考时间有限，需要高强度刷题训练
- **在校学生**：准备期末考试/资格考试，需要系统化的题库资源

### 2.2 核心痛点
1. **找不到题库**：网上题库分散，质量参差不齐
2. **整理耗时**：自己整理题库需要大量时间
3. **刷题体验差**：手机屏幕小，题目答案切换不方便
4. **解析不清晰**：只给答案不给解析，或者解析太简单看不懂

### 2.3 关键使用场景
- **场景1：首次刷题**：用户进入题库广场，选择对应科目的题库，开始系统刷题
- **场景2：继续刷题**：用户打开"我的进度"，继续上次未完成的题库
- **场景3：错题复习**：用户打开错题本，针对错题进行集中复习
- **场景4：AI追问**：用户对某个解析不理解，点击"AI追问"获取更深入的解释

---

## 三、产品路线图 (Product Roadmap)

### V1: 最小可行产品 (MVP)

#### 核心功能
1. **题库广场**
   - 浏览所有已发布的题库
   - 按科目/考试类型分类（驾考/高数/英语/专业课等）
   - 显示题库信息（名称、题目数量、难度、更新时间）
   - 搜索题库功能

2. **一屏一题刷题界面**
   - 左右分栏布局（左题目、右答案+解析）
   - 支持选择题/填空题/大题
   - 点击题目显示正确答案
   - 答案下方显示详细解析
   - 上一题/下一题导航
   - 题目进度显示（如：15/100）

3. **错题本**
   - 自动记录用户答错的题目
   - 错题重新练习功能
   - 错题移除功能

4. **刷题进度**
   - 显示每个题库的完成度
   - 记录上次刷题位置
   - 继续刷题功能

5. **AI追问功能**
   - 在解析下方显示"AI追问"按钮
   - 点击后弹出对话框
   - 用户可提问，AI实时回答
   - 支持多轮对话

6. **用户登录**
   - 邮箱注册/登录
   - JWT会话管理
   - 无登录也可浏览题库，但刷题需要登录

### V2 及以后版本 (Future Releases)

#### V2 功能
- **用户上传题库**：允许用户自己上传题库文件（TXT/MD）
- **题库评价**：用户可对题库点赞/评论/报错
- **学习统计**：刷题时长、正确率、学习曲线
- **刷题模式**：随机模式、章节模式、错题重练模式
- **题库收藏**：用户可收藏喜欢的题库

#### V3 功能
- **社区功能**：题库分享、学习小组
- **移动端优化**：响应式设计，支持平板和手机
- **智能推荐**：根据学习历史推荐题库
- **错题导出**：导出错题本为PDF

---

## 四、关键业务逻辑 (Business Rules)

### 4.1 题库可见性规则
1. **题库广场**：显示所有 `is_published=true` 的题库
2. **用户权限**：无需登录即可浏览题库广场
3. **刷题权限**：需要登录才能开始刷题（记录进度）

### 4.2 刷题流程规则
1. **首次刷题**：从第一题开始
2. **继续刷题**：从上次停止的位置继续
3. **错题记录**：用户答题错误时，自动加入错题本
4. **进度保存**：每题完成后自动保存进度

### 4.3 题目分类规则
1. **选择题**：单选、多选，显示选项和正确答案
2. **填空题**：显示答案和解析
3. **大题**：
   - 如果是证明题/计算题，改为选项形式或直接看答案
   - 右侧显示答案和详细解析

### 4.4 AI追问规则
1. **触发条件**：用户点击"AI追问"按钮
2. **追问内容**：用户可针对当前题目或解析提问
3. **对话模式**：支持多轮对话，上下文关联
4. **成本控制**：限制每个用户每天的追问次数（如20次）

---

## 五、数据契约 (Data Contract)

### 5.1 核心实体

#### users（用户表）
```sql
users (
  id UUID PRIMARY KEY,
  email VARCHAR(255) UNIQUE NOT NULL,
  password_hash VARCHAR(255) NOT NULL,
  name VARCHAR(100),
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
)
```

#### quizzes（题库表）
```sql
quizzes (
  id UUID PRIMARY KEY,
  title VARCHAR(255) NOT NULL,           -- 题库名称
  description TEXT,                       -- 题库描述
  subject VARCHAR(100),                   -- 科目分类（驾考/高数/英语等）
  exam_type VARCHAR(100),                 -- 考试类型
  difficulty VARCHAR(20),                 -- 难度（简单/中等/困难）
  question_count INT DEFAULT 0,           -- 题目数量
  is_published BOOLEAN DEFAULT false,     -- 是否发布
  html TEXT,                              -- 生成的HTML内容
  order_mode INT DEFAULT 0,               -- 排序模式
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
)
```

#### user_progress（用户进度表）
```sql
user_progress (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES users(id),
  quiz_id UUID REFERENCES quizzes(id),
  current_index INT DEFAULT 0,            -- 当前题目索引
  completed_count INT DEFAULT 0,          -- 已完成题目数
  correct_count INT DEFAULT 0,            -- 正确题目数
  wrong_count INT DEFAULT 0,              -- 错误题目数
  last_accessed_at TIMESTAMP DEFAULT NOW(),
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(user_id, quiz_id)
)
```

#### wrong_questions（错题表）
```sql
wrong_questions (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES users(id),
  quiz_id UUID REFERENCES quizzes(id),
  question_index INT NOT NULL,            -- 题目索引
  question_text TEXT NOT NULL,            -- 题目内容（冗余存储）
  wrong_answer TEXT,                      -- 用户的错误答案
  correct_answer TEXT NOT NULL,           -- 正确答案
  explanation TEXT,                       -- 解析
  created_at TIMESTAMP DEFAULT NOW(),
  is_resolved BOOLEAN DEFAULT false       -- 是否已掌握
)
```

#### ai_conversations（AI对话记录表）
```sql
ai_conversations (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES users(id),
  quiz_id UUID REFERENCES quizzes(id),
  question_index INT,                     -- 关联的题目索引
  messages JSONB NOT NULL,                -- 对话历史 [{"role":"user","content":"..."}]
  created_at TIMESTAMP DEFAULT NOW()
)
```

### 5.2 数据读写频率与一致性要求

#### 高频读取
- **题库列表**：每次进入题库广场
- **题目内容**：每次刷题切换题目
- **用户进度**：每次进入刷题界面

#### 中频写入
- **用户进度**：每完成一题更新一次
- **错题记录**：答题错误时写入
- **AI对话**：用户追问时写入

#### 数据一致性
- **最终一致性**：用户进度允许短暂延迟（秒级）
- **强一致性**：题库发布状态必须实时更新

---

## 六、UI/UX 设计要求

### 6.1 设计原则
1. **大屏优先**：优先电脑端体验（1920x1080）
2. **左右分栏**：左题目（40%）、右答案+解析（60%）
3. **简洁清晰**：减少视觉干扰，聚焦题目和答案
4. **即时反馈**：点击即可看到答案，无等待

### 6.2 题库广场布局

```
┌─────────────────────────────────────────────────────────────┐
│  Changli OJ - 题库广场                                       │
├─────────────────────────────────────────────────────────────┤
│  搜索框: [按科目/题库名称搜索...]                    [登录] │
├─────────────────────────────────────────────────────────────┤
│  分类导航: [全部] [驾考] [高数] [英语] [专业课]            │
├─────────────────────────────────────────────────────────────┤
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │
│  │ 驾考科目一   │  │ 驾考科目四   │  │ 高数上册     │      │
│  │ 题目: 1500   │  │ 题目: 1200   │  │ 题目: 500    │      │
│  │ 难度: ★★☆   │  │ 难度: ★★★   │  │ 难度: ★★★☆  │      │
│  │ 更新: 2天前  │  │ 更新: 1天前  │  │ 更新: 5天前  │      │
│  │ [开始刷题]   │  │ [开始刷题]   │  │ [开始刷题]   │      │
│  └──────────────┘  └──────────────┘  └──────────────┘      │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │
│  │ 大学英语四级 │  │ 数据结构     │  │ 操作系统     │      │
│  │ 题目: 2000   │  │ 题目: 800    │  │ 题目: 600    │      │
│  │ 难度: ★★☆   │  │ 难度: ★★★★  │  │ 难度: ★★★★  │      │
│  │ 更新: 1周前  │  │ 更新: 3天前  │  │ 更新: 1周前  │      │
│  │ [开始刷题]   │  │ [开始刷题]   │  │ [开始刷题]   │      │
│  └──────────────┘  └──────────────┘  └──────────────┘      │
└─────────────────────────────────────────────────────────────┘
```

### 6.3 刷题界面布局

```
┌────────────────────────────────────────────────────────────────────┐
│  驾考科目一 - 刷题中                             [返回题库广场]   │
│  进度: 15/1500  错题: 2题  [上一题]  [下一题]                    │
├──────────────────────────────┬─────────────────────────────────────┤
│                              │                                     │
│  题目区域（40%）              │  答案+解析区域（60%）               │
│  ┌────────────────────────┐  │  ┌──────────────────────────────┐  │
│  │ 1. 驾驶机动车在高速    │  │  │ ✅ 正确答案: B                │  │
│  │    公路上行驶，车速    │  │  │                              │  │
│  │    超过100km/h时，    │  │  │ 📝 详细解析:                  │  │
│  │    应与同车道前车保    │  │  │ 根据《道路交通安全法》第67条  │  │
│  │    持多少米以上的距    │  │  │ 规定，在高速公路上行驶，车速  │  │
│  │    离？                │  │  │ 超过100km/h时，与同车道前车  │  │
│  │                        │  │  │ 距离应保持100米以上。这是为  │  │
│  │  A. 50米以上           │  │  │ 了保证有足够的刹车距离，避  │  │
│  │  B. 100米以上          │  │  │ 免追尾事故。高速公路车速快，  │  │
│  │  C. 150米以上          │  │  │ 反应时间短，因此需要保持更  │  │
│  │  D. 200米以上          │  │  │ 长的安全距离。               │  │
│  │                        │  │  │                              │  │
│  │  [点击查看答案]        │  │  │ 🤖 [AI追问]                   │  │
│  └────────────────────────┘  │  └──────────────────────────────┘  │
│                              │                                     │
├──────────────────────────────┴─────────────────────────────────────┤
│  [收藏本题]  [标记错题]  [分享本题]                               │
└────────────────────────────────────────────────────────────────────┘
```

### 6.4 错题本界面

```
┌─────────────────────────────────────────────────────────────┐
│  我的错题本                                 [返回]          │
│  共 23 道错题                                [清空错题本]   │
├─────────────────────────────────────────────────────────────┤
│  筛选: [全部题库] [驾考科目一] [高数上册]                   │
│  排序: [最新错题] [错题次数] [相关度]                       │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 1. 驾驶机动车在高速公路上行驶...          [驾考科目一]│   │
│  │    错误次数: 2次  最后错误: 2小时前                   │   │
│  │    [重新练习]                                       │   │
│  └─────────────────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 2. 设函数f(x)=x²-2x+3，求f'(1)的值       [高数上册]  │   │
│  │    错误次数: 3次  最后错误: 1天前                    │   │
│  │    [重新练习]                                       │   │
│  └─────────────────────────────────────────────────────┘   │
│  ...                                                         │
└─────────────────────────────────────────────────────────────┘
```

### 6.5 AI追问界面（模态框）

```
┌────────────────────────────────────────────────┐
│  AI 追问 - 题目 #1                            │
├────────────────────────────────────────────────┤
│  ┌──────────────────────────────────────────┐ │
│  │ 用户: 为什么高速上要保持100米以上的距离？  │ │
│  │                                          │ │
│  │ AI: 这是一个关于安全距离的好问题！在高速 │ │
│  │     公路上保持100米以上的距离主要有以下   │ │
│  │     几个原因：                            │ │
│  │     1. 反应时间：人在高速行驶时，从发现   │ │
│  │        前方情况到采取刹车动作，平均需要   │ │
│  │        1-2秒的反应时间...                │ │
│  │                                          │ │
│  │ 用户: 那雨天需要保持多少距离？            │ │
│  │                                          │ │
│  │ AI: 雨天路面湿滑，刹车距离会显著增加...   │ │
│  └──────────────────────────────────────────┘ │
│  ┌──────────────────────────────────────────┐ │
│  │ [输入你的问题...]                        │ │
│  └──────────────────────────────────────────┘ │
│                            [发送]  [关闭对话] │
└────────────────────────────────────────────────┘
```

---

## 七、技术架构建议

### 7.1 前端技术栈
- **框架**: Next.js 14+ (App Router)
- **样式**: Tailwind CSS
- **状态管理**: React Context / Zustand
- **UI组件**: shadcn/ui
- **AI集成**: Vercel AI SDK

### 7.2 后端技术栈
- **API**: Next.js API Routes
- **数据库**: Supabase (PostgreSQL)
- **认证**: Supabase Auth / NextAuth.js
- **AI服务**: Gemini API / OpenAI API

### 7.3 核心依赖
```json
{
  "dependencies": {
    "next": "^14.0.0",
    "react": "^18.0.0",
    "supabase-js": "^2.0.0",
    "ai": "^3.0.0",
    "@radix-ui/react-dialog": "^1.0.0",
    "tailwindcss": "^3.0.0"
  }
}
```

---

## 八、成功指标 (KPI)

### 8.1 核心指标
- **题库覆盖率**：目标考试科目的题库覆盖率 ≥ 80%
- **刷题完成率**：用户开始刷题后，完成率 ≥ 30%
- **用户留存率**：7日留存率 ≥ 20%
- **AI追问使用率**：刷题用户中使用AI追问的比例 ≥ 15%

### 8.2 体验指标
- **题目加载速度**：首屏题目加载时间 < 1秒
- **AI追问响应时间**：平均响应时间 < 3秒
- **错误率**：系统错误率 < 0.1%

---

## 九、风险与假设

### 9.1 关键假设
1. **题库内容质量**：假设开发者能够提供高质量、准确的题库内容
2. **AI追问成本**：假设AI API成本在可控范围内
3. **用户偏好**：假设用户优先使用电脑端刷题

### 9.2 主要风险
1. **题库内容不足**：如果题库数量少，用户可能流失
2. **AI追问成本过高**：如果用户频繁使用AI，成本可能超预算
3. **答案准确性**：如果题库答案有误，影响用户信任度
4. **版权问题**：题库内容可能涉及版权问题

### 9.3 缓解措施
1. **题库内容**：优先处理热门科目，快速建立题库护城河
2. **AI追问成本**：设置每日追问次数限制（20次/天）
3. **答案准确性**：建立用户报错机制，及时修正错误答案
4. **版权问题**：仅使用公开的真题或用户授权的题库

---

## 十、附录

### 10.1 竞品分析
- **驾考宝典**：题库丰富，但广告多，界面复杂
- **粉笔**：刷题体验好，但主要针对公务员考试
- **Quizlet**：国际化，但缺乏本土化内容

### 10.2 参考资料
- 前项目梳理文档
- 驾考题库样例
- AI集成最佳实践

---

**文档结束**
